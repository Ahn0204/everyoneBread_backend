<!--
******************************************
*  Created On : 2025. 11. 16.
*  File : admin-layout.html
*******************************************
 -->
<!DOCTYPE html>
<!--layout:decorate 기능을 사용하기 위한 속성 추가-->
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
    <head>
        <meta charset="UTF-8" />
        <script src="https://code.jquery.com/jquery-latest.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script th:src="@{/js/comm/sweetalert.noah.js}"></script>
        <!--csrf토근 헤더 추가-->
        <meta name="_csrf" th:content="${_csrf.token}" />
        <meta name="_csrf_header" th:content="${_csrf.headerName}" />
        <!-- BootStrap CDN -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" />
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css" />
        <!--자식페이지에서 추가로 삽입될 head내용-->
        <th:block layout:fragment="head"></th:block>
        <style>
            /*헤더 바탕색*/
            .bg-body-tertiary {
                background-color: cornflowerblue !important;
            }
            /*헤더 네비게이션바*/
            .headerNav {
                display: flex;
                flex-direction: row;
                width: 50%;
                text-align: center;
            }
            .headerNav-1,
            .headerNav-2,
            .headerNav-3 {
                min-width: 85px;
                flex: 0.8;
            }
            .headerNav-4 {
                min-width: 150px;
                flex: 1.5;
            }
            .headerNav > .nav-link,
            .util-text {
                color: white;
                font-size: 18px;
                font-weight: 600;
            }
            .headerNav > .active {
                background-color: white !important;
                color: cornflowerblue !important;
            }
            /*헤더 사용자이름*/
            .util-text-name {
                color: white;
                font-size: 18px;
                font-weight: 500;
            }

            /*사이드바+본문 여백 설정*/
            .container-fluid.flex-grow-1 {
                padding-left: 0 !important;
                padding-right: 12px !important;
            }

            /*사이드바*/
            .nav-link {
                color: white;
            }
            .nav-link:focus,
            .nav-link:hover {
                color: white;
                background-color: cornflowerblue;
            }
            /*메인색 변경*/
            .btn-primary {
                background-color: cornflowerblue;
                border-color: white;
            }
            .nav-link :active {
                background-color: cornflowerblue;
                border-color: white;
            }
        </style>
        <title>모두의 빵</title>
    </head>

    <body class="d-flex flex-column min-vh-100">
        <!--헤더-->
        <header class="bg-body-tertiary position-sticky top-0" style="z-index: 1030">
            <!--html통째로 아래 div를 replace-->
            <div th:replace="~{/admin/comm/admin-header}"></div>
        </header>

        <!--헤더 아래 출력부-->
        <div class="container-fluid flex-grow-1">
            <div class="row">
                <!--사이드바-->
                <div th:replace="~{/admin/comm/admin-sidebar}"></div>
                <!--본문-->
                <main class="col-md-9 ms-sm-auto col-lg-10 p-md-4">
                    <!--admin-layout상속한 페이지의 content 출력부-->
                    <th:block layout:fragment="content"></th:block>
                </main>
            </div>
        </div>

        <!--푸터-->
        <footer class="mt-auto py-3 bg-light text-center">
            <p>ⓒ 2025 모두의 빵 관리자 시스템</p>
        </footer>

        <!--fragment로 쓰이는 script에 선언하면 덮어쓰기되므로, 부모에 사용이 필요한 script는 따로 작성-->
        <script type="text/javascript">
            //ajax사용시 csrf헤더 생성
            $(function () {
                const token = $('meta[name="_csrf"]').attr('content');
                const header = $('meta[name="_csrf_header"]').attr('content');
                $(document).ajaxSend(function (e, xhr) {
                    if (token && header) xhr.setRequestHeader(header, token);
                });
            });

            //헤더 & 사이드바에 현재 페이지 표시
            //현재 페이지의 uri가져오기
            let uri = $(location).attr('pathname').split('/'); //window.location.pathname; 전체 url일 경우 => pathname대신 href

            switch (
                uri[2] //uri를 /로 자른 String의 배열 중 2번째 요소가 다음과 같다면
            ) {
                case 'settlement':
                    //헤더id=settlement인 선택자에 class에 active값 추가, aria-current=page 추가
                    $('#settlement').addClass('active').attr('aria-current', 'page');
                    //사이드바 해당하지 않는 메뉴의 class에서 show속성 삭제
                    $('#menuSettlement').addClass('show');
                    //사이드바 해당하는 메뉴의 class에 active속성 추가
                    switch (uri[3]) {
                        case 'settlement-list':
                            $('#menuSettlement ul li').eq(0).find('a').addClass('active');
                            break;
                        case 'feeHistory-list':
                            $('#menuSettlement ul li').eq(1).find('a').addClass('active');
                            break;
                        case 'distanceFeeHistory-list':
                            $('#menuSettlement ul li').eq(2).find('a').addClass('active');
                            break;
                    }
                    break;
                case 'user':
                    $('#user').addClass('active').attr('aria-current', 'page');
                    $('#menuUser').addClass('show');
                    //사이드바 입/폐점 관리 항목 펼치기
                    $('#menuShopList').addClass('show');
                    //사이드바 해당하는 메뉴의 class에 active속성 추가
                    switch (uri[3]) {
                        case 'shopApproval-list':
                            $('#menuUser ul li').eq(1).find('a').addClass('active');
                            break;
                        case 'shopClose-list':
                            $('#menuUser ul li').eq(2).find('a').addClass('active');
                            break;
                        case 'riderApproval-list':
                            $('#menuUser ul li').eq(3).find('a').addClass('active');
                            break;
                        case 'admin-list':
                            $('#menuUser ul li').eq(4).find('a').addClass('active');
                            break;
                        case 'user-list':
                            $('#menuUser ul li').eq(5).find('a').addClass('active');
                            break;
                    }
                    break;
                case 'inquiry':
                    $('#inquiry').addClass('active').attr('aria-current', 'page');
                    $('#menuInquiry').addClass('show');
                    switch (uri[3]) {
                        case 'inquiry-list':
                            $('#menuInquiry ul li').eq(0).find('a').addClass('active');
                            break;
                        case 'banInquiry-list':
                            $('#menuInquiry ul li').eq(1).find('a').addClass('active');
                            break;
                    }
                    break;
                case 'homePage':
                    $('#homePage').addClass('active').attr('aria-current', 'page');
                    $('#menuHomePage').addClass('show');
                    switch (uri[3]) {
                        case 'notice-list':
                            $('#menuHomePage ul li').eq(0).find('a').addClass('active');
                            break;
                        case 'category-list':
                            $('#menuHomePage ul li').eq(1).find('a').addClass('active');
                            break;
                    }
                    break;
                default: //메인일 때
                    //모든 사이드바 항목 펼치기
                    $('ul li .collapse').addClass('show');
                    break;
            }
            //로그아웃 버튼클릭 시 confirm알림
            $(document).ready(function () {
                $('.util-logout').on('click', function () {
                    showConfirmAlert(
                        '로그아웃 하시겠습니까?\n로그인 페이지로 이동합니다.',
                        () => {
                            //예
                            $('form[name="logoutForm"]').submit();
                        },
                        () => {
                            //아니오
                        }
                    );
                });
            });
        </script>
        <!--자식 script 삽입부-->
        <script layout:fragment="script" type="text/javascript"></script>
    </body>
</html>
