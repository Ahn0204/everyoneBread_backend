<div class="cartListBox border d-flex flex-column p-2" style="width: 30vw">
    <h4>주문표</h4>
    <form th:action="@{/order/orderForm}" method="POST" name="cartForm">
        <!--상점명-->
        <div class="shopNameBox">
            <h4>
                <span class="shopName badge text-bg-dark" th:text="${shop.shopName}"></span>
            </h4>
        </div>
        <!--상품 목록-->
        <div class="cart-product rounded border p-2"></div>
        <!--주문 금액-->
        <div class="price-box">
            <div class="d-flex justify-content-between">
                <div>
                    <b>배송비</b>
                </div>
                <div>
                    <span class="deliveryFee" th:text="${deliveryFee}"></span>
                    <span>원</span>
                </div>
            </div>
            <div class="d-flex justify-content-between mt-2">
                <b>주문 금액</b>
                <div>
                    <span class="cart-totalPrice"></span>
                    <span>원</span>
                </div>
            </div>
        </div>
        <!--주문 버튼-->
        <div class="cart-btns mt-2">
            <button class="deleteAllBtn btn btn-secondary">비우기</button>
            <button sec:authorize="isAnonymous()" class="beforeLogin btn btn-primary" disabled>주문</button>
            <button sec:authorize="isAuthenticated()" class="orderBtn btn btn-primary">주문</button>
        </div>
    </form>
</div>

<script type="text/javascript" th:inline="javascript">
    //$(document).ready()대신 사용
    $(function () {
        showCart();
        //cart 삭제
        $('.deleteAllBtn').on('click', function () {
            showConfirmAlert(
                '주문이 모두 삭제됩니다.',
                () => {
                    deleteCart();
                },
                () => {}
            );
        });

        //장바구니 비우기
        function deleteCart() {
            sessionStorage.removeItem('shopNo');
            sessionStorage.removeItem('cart');
            location.reload(); //페이지 새로고침
        }

        //주문 버튼
        $('.orderBtn').on('click', function () {
            const deliveryFee = $('.deliveryFee').text();
            showConfirmAlert(
                '주문 페이지로 이동합니다.',
                () => {
                    const form = $('form[name = "cartForm"]');
                    form.append($('<input>').attr('type', 'hidden').attr('name', 'deliveryFee').val(deliveryFee));
                    form.submit();
                },
                () => {}
            );
        });

        //비로그인 시
        $('.beforeLogin').on('click', function () {
            showConfirmAlert(
                '로그인이 필요합니다. \n 페이지를 이동하겠습니까?',
                () => {
                    window.location = '/member/login';
                },
                () => {}
            );
        });
    });
</script>
