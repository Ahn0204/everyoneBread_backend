<div class="cartListBox border d-flex flex-column p-2" style="min-width: 200px; width: 30vw">
    <form th:action="@{/order/orderForm}" method="POST" name="cartForm">
        <div class="shopNameBox d-flex justify-content-between border-bottom border-3 pt-1 ps-2 pe-2">
            <h4>주문표</h4>
            <!--상점명-->
            <h4>
                <span class="shopName badge text-bg-dark" th:text="${shop.shopName}"></span>
            </h4>
        </div>
        <!--상품 목록-->
        <div class="cart-product rounded border ps-2 pe-2 mt-2 mb-2"></div>
        <!--주문 금액-->
        <div class="price-box m-2">
            <div class="d-flex justify-content-between">
                <div>
                    <b>배송비</b>
                </div>
                <div>
                    <span class="deliveryFee" th:text="${deliveryFee}"></span>
                    <span>원</span>
                    <input type="hidden" name="deliveryFee" class="deliveryFee" />
                </div>
            </div>
            <div class="d-flex justify-content-between mt-2">
                <b>주문 금액</b>
                <div>
                    <span class="cart-totalPrice"></span>
                    <span>원</span>
                </div>
            </div>
        </div>
        <!--주문 버튼-->
        <div class="cart-btns m-2 d-flex justify-content-between">
            <button type="button" class="deleteAllBtn btn btn-secondary">비우기</button>
            <div>
                <button sec:authorize="isAnonymous()" type="button" class="beforeLogin btn btn-primary" disabled>주문</button>
                <button sec:authorize="isAuthenticated()" type="button" class="orderBtn btn btn-primary" disabled>주문</button>
            </div>
        </div>
    </form>
</div>

<script type="text/javascript" th:inline="javascript">
    //$(document).ready()대신 사용
    $(function () {
        showCart();
        //cart 삭제
        $('.deleteAllBtn').on('click', function () {
            showConfirmAlert(
                '주문이 모두 삭제됩니다.',
                () => {
                    deleteCart();
                },
                () => {}
            );
        });

        //장바구니 비우기
        function deleteCart() {
            sessionStorage.removeItem('shopNo');
            sessionStorage.removeItem('cart');
            $('.cart-product').empty();
            showCart();
        }

        //주문 버튼
        $('.orderBtn').on('click', function () {
            const deliveryFee = $('.deliveryFee').text();
            showConfirmAlert(
                '주문 페이지로 이동합니다.',
                () => {
                    const form = $('form[name = "cartForm"]');
                    $('.deliveryFee').val(deliveryFee);
                    // form.append($('<input>').attr('type', 'hidden').attr('name', 'deliveryFee').val(deliveryFee));
                    form.submit();
                },
                () => {}
            );
        });

        //비로그인 시
        $('.beforeLogin').on('click', function () {
            showConfirmAlert(
                '로그인이 필요합니다. \n 페이지를 이동하겠습니까?',
                () => {
                    window.location = '/member/login';
                },
                () => {}
            );
        });
    });
</script>
