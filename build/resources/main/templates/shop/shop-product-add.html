<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{shop/common/shop-layout}">
    <head>
        <meta charset="UTF-8" />
        <!-- SweetAlert2 -->
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script th:src="@{/js/comm/sweetalert.noah.js}"></script>
        <link rel="stylesheet" th:href="@{/css/shop/product-add.css}" />
    </head>

    <body>
        <div layout:fragment="content">
            <div class="product-add-container">
                <div class="product-title">상품 등록</div>

                <form id="productForm" th:action="@{/shop/products/add}" method="post" enctype="multipart/form-data">
                    <table class="product-form-table">
                        <!-- 상품명 -->
                        <tr>
                            <td class="product-label">상품명</td>
                            <td><input type="text" name="productName" class="product-input" required /></td>
                        </tr>

                        <!-- 이미지 -->
                        <tr>
                            <td class="product-label">대표 이미지</td>
                            <td>
                                <div class="image-upload-wrapper">
                                    <div class="image-preview-box" id="previewBox">기본 이미지</div>

                                    <div style="display: flex; flex-direction: column; gap: 8px">
                                        <input type="file" name="image" id="imageInput" accept="image/*" class="product-input" />
                                        <!-- <span class="file-name" id="fileName"></span> -->
                                        <button type="button" class="delete-img-btn" id="deleteImgBtn">이미지 삭제</button>
                                    </div>
                                </div>
                            </td>
                        </tr>

                        <!-- 가격 -->
                        <tr>
                            <td class="product-label">가격</td>
                            <td><input type="text" id="priceInput" class="product-input" required /></td>
                        </tr>

                        <!-- 숨겨진 input (숫자만 서버로 전송) -->
                        <input type="hidden" name="price" id="priceHidden" />

                        <!-- 한줄 소개 -->
                        <tr>
                            <td class="product-label">한줄 소개</td>
                            <td><input type="text" name="summary" class="product-input" /></td>
                        </tr>

                        <!-- 재료 -->
                        <tr>
                            <td class="product-label">재료</td>
                            <td><input type="text" name="ingredient" class="product-input" /></td>
                        </tr>

                        <!-- 카테고리 -->
                        <tr>
                            <td class="product-label">카테고리</td>
                            <td>
                                <select name="catName" class="product-input" required>
                                    <<<<<<< HEAD
                                    <option value="CROISSANT">크루아상</option>
                                    <option value="BREAD">식빵</option>
                                    <option value="MUFFIN">머핀</option>
                                    <option value="CASTELLA">카스테라</option>
                                    =======
                                    <option value="빵">빵</option>
                                    <option value="케이크">케이크</option>
                                    <option value="디저트">디저트</option>
                                    <option value="커피">커피</option>
                                    >>>>>>> main
                                </select>
                            </td>
                        </tr>
                    </table>

                    <button type="button" id="submitBtn" class="submit-btn">등록</button>
                </form>
            </div>
            <<<<<<< HEAD

            <script>
                // 이미지 용량 + 확장자 검사
                document.getElementById('imageInput').addEventListener('change', function (e) {
                    let file = e.target.files[0];
                    let preview = document.getElementById('previewBox');
                    // let fileName = document.getElementById("fileName");

                    if (!file) return;

                    // 확장자 검사
                    // JPG, PNG 만 허용
                    const allowExt = ['jpg', 'jpeg', 'png'];
                    let ext = file.name.split('.').pop().toLowerCase();
                    if (!allowExt.includes(ext)) {
                        showErrorAlert('JPG, PNG 이미지만 업로드 가능합니다.');
                        e.target.value = '';
                        return;
                    }

                    // 용량 검사 (5MB 이하)
                    if (file.size > 5 * 1024 * 1024) {
                        showErrorAlert('이미지 용량은 5MB 이하만 가능합니다.');
                        e.target.value = '';
                        return;
                    }

                    // 이미지 해상도 검사
                    let img = new Image();
                    img.onload = function () {
                        if (img.width < 600 || img.height < 600) {
                            showErrorAlert('이미지는 최소 600×600px 이상이어야 합니다.');
                            e.target.value = '';
                            return;
                        }
                    };
                    img.src = URL.createObjectURL(file);

                    // 미리보기
                    let reader = new FileReader();
                    reader.onload = function (event) {
                        preview.innerHTML = `<img src="${event.target.result}" 
                                    style="width:100%; height:100%; object-fit:cover;">`;
                    };
                    reader.readAsDataURL(file);

                    // 파일명 표시
                    // fileName.textContent = "파일명: " + file.name;
                });

                // 삭제 버튼
                document.getElementById('deleteImgBtn').addEventListener('click', function () {
                    document.getElementById('imageInput').value = '';
                    document.getElementById('previewBox').innerHTML = '기본 이미지';
                    document.getElementById('fileName').textContent = '';
                });

                // 가격 3자리 콤마 적용
                const priceInput = document.getElementById('priceInput');
                const priceHidden = document.getElementById('priceHidden');

                priceInput.addEventListener('input', () => {
                    let num = priceInput.value.replace(/[^0-9]/g, '');
                    priceHidden.value = num; // 숫자만 hidden으로 저장
                    priceInput.value = num.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                });

                // 등록 버튼 클릭 시
                document.getElementById('submitBtn').addEventListener('click', () => {
                    Swal.fire({
                        title: '상품을 등록할까요?',
                        icon: 'question',
                        showCancelButton: true,
                        confirmButtonText: '등록',
                        cancelButtonText: '취소',
                    }).then((result) => {
                        if (result.isConfirmed) {
                            document.getElementById('productForm').submit();
                        }
                    });
                });
            </script>
            =======
            <script th:src="@{/js/shop/product-add.js}"></script>
            >>>>>>> main
        </div>
    </body>
</html>
