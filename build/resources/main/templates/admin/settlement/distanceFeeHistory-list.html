<!--
******************************************
*  Created On : 2025. 11. 27.
*  File : settlement-list.html
*******************************************
 -->
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{admin/comm/admin-layout}">
    <head>
        <th:block layout:fragment="head">
            <style>
                /*항목 너비 설정하는 레이아웃css*/
                .div-cols {
                    /*항목을 담는 div에 지정*/
                    display: flex;
                    flex-direction: row;
                    width: 100%;
                    padding: 20px 10px 10px 20px;
                }
                .div-col-1 {
                    flex: 0.7;
                } /* 번호 */
                .div-col-2 {
                    flex: 1.2;
                } /* 항목 */
                .div-col-3 {
                    flex: 1;
                } /* 변경 전 */
                .div-col-4 {
                    flex: 1;
                } /* 작업내용 */
                .div-col-5 {
                    flex: 1.5;
                } /* 가입일시 */
            </style>
        </th:block>
    </head>
    <body>
        <!--레이아웃의 content 부분에 아래 내용이 출력됨-->
        <div layout:fragment="content">
            <div class="listAndList-header m-2">
                <div class="list-header"><h3>배송비 변경</h3></div>
                <div class="distanceFee border p-3">
                    <form th:action="@{/admin/settlement/insertDistanceFee}" method="post" name="distanceFeeForm" th:object="${distanceFeeForm}">
                        <!--유효성 검증에 에러 발생 시 에러 출력 -->
                        <div th:replace="~{comm/formErrors :: formErrorsFragment}"></div>

                        <label for="distance">거리</label>
                        <label for="deliveryFee">배송료</label>
                        <!-- <table th:each="${distanceFee}"> -->
                        <table>
                            <tr>
                                <td>0~</td>
                                <td>
                                    <input type="number" th:field="*{distance}" class="me-1" min="0" value="${distanceFee}" size="20" placeholder="0이상 입력 가능" />
                                    km
                                </td>
                                <td>
                                    <input type="number" th:field="*{deliveryFee}" class="me-1" min="0" value="0" size="20" placeholder="0이상 입력 가능" />
                                    원
                                </td>
                                <td>
                                    <input type="button" value="변경" class="btn update btn-secondary" />
                                    <input type="button" value="삭제" class="btn delete btn-secondary" />
                                </td>
                            </tr>
                        </table>

                        ~
                        <input type="number" th:field="*{distance}" id="createDistance" class="me-1" min="0" value="${distanceFee}" size="20" placeholder="0이상 입력 가능" />
                        km
                        <input type="number" th:field="*{deliveryFee}" id="createDeliveryFee" class="me-1" min="0" value="0" size="20" placeholder="0이상 입력 가능" />
                        원
                        <input type="button" value="생성" class="btn create btn-secondary" disabled />

                        <th:block th:if="${isSucceeded} != null">
                            <script th:if="${isSucceeded}">
                                showToast('변경 완료', 'success');
                            </script>
                            <script th:unless="${isSucceeded}">
                                showToast('다시 시도해주세요.', 'error');
                            </script>
                        </th:block>
                    </form>
                </div>
                <div class="update-list" style="max-width: 1000px; min-width: 800px">
                    <div class="div-cols border-bottom border-3 border-dark fw-b text-center">
                        <div class="div-col-1 fw-bold">번호</div>
                        <div class="div-col-2 fw-bold">항목</div>
                        <div class="div-col-3 fw-bold">변경 전</div>
                        <div class="div-col-4 fw-bold">작업내용</div>
                        <div class="div-col-3 fw-bold">변경 후</div>
                        <div class="div-col-4 fw-bold">작업자</div>
                        <div class="div-col-5 fw-bold">변경 일시</div>
                    </div>
                    <!--변경 내역이 없을 때-->
                    <div th:if="${noUpdate}">
                        <div class="p-2 flex-fill" th:text="${noUpdate}"></div>
                    </div>
                    <!--관리자 내역이 있을 때-->
                    <div th:unless="${noUpdate}">
                        <div class="update-history-list">
                            <!--항목 담는 div(css 레이아웃 틀)-->
                            <div class="accordion-item div-cols border-bottom border-1 border-secondary text-center" th:each="fee, loop : ${distanceFeeP}">
                                <!--항목-->
                                <div class="div-col-1" th:text="${start - loop.index}"></div>
                                <div class="div-col-2">항목</div>
                                <div class="div-col-3" th:text="${fee.distanceFeeBefore}"></div>
                                <div class="div-col-4" th:text="${fee.operation}"></div>
                                <div class="div-col-3" th:text="${fee.distanceFeeAfter}"></div>
                                <div class="div-col-4" th:text="${fee.memberNo}"></div>
                                <div class="div-col-5" th:text="${#temporals.format(fee.createdAt, 'YY-MM-dd HH:mm')}"></div>
                            </div>
                        </div>
                        <!--페이지 블럭-->
                        <div th:unless="${noUpdate}">
                            <ul class="pagination justify-content-center p-2 mt-3">
                                <!--이전 버튼-->
                                <li class="page-item" th:classappend="${!distanceFeeP.hasPrevious} ? 'disabled' ">
                                    <a class="page-link" th:text="이전" th:href="@{|?page=${distanceFeeP.number-1}|}"></a>
                                </li>
                                <!--페이지 숫자 버튼-->
                                <li class="page-item" th:each="pageNum : ${#numbers.sequence(0,distanceFeeP.totalPages-1)}" th:classappend="${pageNum == distanceFeeP.number} ? 'active'">
                                    <a class="page-link" th:href="@{|?page=${pageNum}|}" th:text="${pageNum}+1"></a>
                                </li>
                                <!--다음 버튼-->
                                <li class="page-item" th:classappend="${!distanceFeeP.hasNext} ? 'disabled'">
                                    <a class="page-link" th:href="@{|?page=${distanceFeeP.number+1}|}" th:text="다음"></a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!--레이아웃의 script 부분에 아래 내용이 출력됨-->
        <script layout:fragment="script">
            $('.update').on('click', function () {
                showConfirmAlert(
                    '배송비를 변경하시겠습니까?', // 표시할 메시지
                    () => {
                        //예
                        $('form[name="distanceFeeForm"]').append(`<input type="hidden" name="operation" value="u" />`);
                        $('form[name="distanceFeeForm"]').submit(); //폼 제출
                    },
                    () => {
                        //아니오
                        showToast('취소되었습니다.', 'warning');
                    }
                );
            });
            $('.create').on('click', function () {
                showConfirmAlert(
                    '배송비를 추가하시겠습니까?', // 표시할 메시지
                    () => {
                        //예
                        $('form[name="distanceFeeForm"]').append(`<input type="hidden" name="operation" value="c" />`);
                        $('form[name="distanceFeeForm"]').submit(); //폼 제출
                    },
                    () => {
                        //아니오
                        showToast('취소되었습니다.', 'warning');
                    }
                );
            });
            $('.delete').on('click', function () {
                showConfirmAlert(
                    '해당 내용을 삭제하시겠습니까?', // 표시할 메시지
                    () => {
                        //예
                        $('form[name="distanceFeeForm"]').append(`<input type="hidden" name="operation" value="d" />`);
                        $('form[name="distanceFeeForm"]').submit(); //폼 제출
                    },
                    () => {
                        //아니오
                        showToast('취소되었습니다.', 'warning');
                    }
                );
            });
        </script>
    </body>
</html>
